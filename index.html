<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025 ä¿¡ç”¨å¡æ¬Šç›Šç²¾ç®— (è©³ç´°ç‰ˆ)</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Microsoft JhengHei", sans-serif;
            background-color: #f4f7f6;
            margin: 0;
            padding: 20px 10px;
            color: #333;
        }
        .container {
            max-width: 500px;
            margin: 0 auto;
            background: #fff;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
        }
        h2 { 
            text-align: center; 
            color: #0087dc; 
            margin-bottom: 5px; 
            font-size: 1.5rem;
        }
        .subtitle {
            text-align: center;
            color: #666;
            font-size: 0.85rem;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px dashed #eee;
        }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; font-size: 0.9rem; color: #555; }
        
        input[type="number"], input[type="datetime-local"], select {
            width: 100%;
            padding: 14px;
            border: 1px solid #ddd;
            border-radius: 12px;
            font-size: 16px;
            background: #fafafa;
            box-sizing: border-box;
            transition: 0.2s;
        }
        select:focus, input:focus { border-color: #0087dc; outline: none; background: #fff; }

        .checkbox-wrapper {
            display: flex;
            align-items: center;
            background: #e3f2fd;
            padding: 12px;
            border-radius: 10px;
            border: 1px solid #bbdefb;
            margin-top: 10px;
            cursor: pointer;
        }
        .checkbox-wrapper input { width: 20px; height: 20px; margin-right: 10px; }
        .checkbox-wrapper span { font-size: 0.9rem; color: #1565c0; font-weight: bold; }

        .cube-section {
            background: linear-gradient(135deg, #ffffff 0%, #f1f2f6 100%); 
            padding: 18px;
            border-radius: 12px;
            border: 2px solid #e0e0e0;
            margin-bottom: 20px;
            margin-top: 25px;
            position: relative;
        }
        .cube-label {
            position: absolute;
            top: -12px; left: 15px;
            background: #0087dc; color: white;
            padding: 2px 10px; border-radius: 10px;
            font-size: 0.8rem; font-weight: bold;
        }

        button {
            width: 100%;
            padding: 16px;
            background: linear-gradient(to right, #0087dc, #00a8e8);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 135, 220, 0.3);
            transition: transform 0.1s;
        }
        button:active { transform: scale(0.98); }

        .result-area { margin-top: 30px; }
        .card-card {
            background: white;
            border: 1px solid #eee;
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }
        .card-card.winner {
            border: 2px solid #27ae60;
            background-color: #f1fcf5;
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.15);
        }
        .card-card.winner .crown { display: block; }
        .card-info h3 { margin: 0 0 5px 0; font-size: 1.1rem; }
        .amount-box { text-align: right; min-width: 90px; }
        .final-profit { font-size: 1.3rem; font-weight: 800; color: #2d3436; }
        .winner .final-profit { color: #27ae60; }
        .crown {
            position: absolute;
            top: -12px; left: -8px;
            font-size: 26px; display: none;
        }
        
        .badge {
            display: inline-block;
            font-size: 0.65rem; padding: 2px 6px;
            border-radius: 4px; margin-top: 4px;
            font-weight: bold;
        }
        .badge-ok { background: #d1fae5; color: #065f46; }
        .badge-fail { background: #fee2e2; color: #991b1b; }
        .badge-10 { background: #fef3c7; color: #92400e; border: 1px solid #fcd34d; }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ¯ 2025 ä¿¡ç”¨å¡æ¬Šç›Šç²¾ç®—</h2>
    <p class="subtitle">æ”¯æ´ï¼šåœ‹æ³° CUBE / å¯Œé‚¦ OP / è¯é‚¦å‰é¶´</p>

    <div class="form-group">
        <label>ğŸ“… æ¶ˆè²»æ™‚é–“</label>
        <input type="datetime-local" id="txnTime">
    </div>

    <div class="form-group">
        <label>ğŸ’° æ¶ˆè²»é‡‘é¡ (TWD)</label>
        <input type="number" id="amount" placeholder="ä¾‹å¦‚ï¼š3000" value="3000" inputmode="numeric">
    </div>

    <div class="form-group">
        <label>ğŸ“ è©³ç´°æ¶ˆè²»é€šè·¯ (è«‹ç²¾æº–é¸æ“‡)</label>
        <select id="scenario">
            <optgroup label="âœˆï¸ æµ·å¤–/æ—…éŠ (CUBE è¶£æ—…è¡Œ)">
                <option value="Travel_Overseas_JP">ğŸ‡¯ğŸ‡µ æ—¥æœ¬ (å¯¦é«”åˆ·å¡/æ’å¡)</option>
                <option value="Travel_Overseas_JP_Apple">ğŸ‡¯ğŸ‡µ æ—¥æœ¬ (Apple Pay / QUICPay)</option>
                <option value="Travel_Overseas_KR">ğŸ‡°ğŸ‡· éŸ“åœ‹ (å¯¦é«”åˆ·å¡)</option>
                <option value="Travel_Overseas_Other">ğŸŒ å…¶ä»–æµ·å¤–åœ‹å®¶ (æ­ç¾/æ±å—äº)</option>
                <option value="Travel_OTA">ğŸ¨ è¨‚æˆ¿ç¶² (Agoda/Booking/Trip.com/Airbnb)</option>
                <option value="Travel_Platform">ğŸ« æ—…éŠå¹³å° (Klook/KKday)</option>
                <option value="Travel_Agency">ğŸ§³ åœ‹å…§æ—…è¡Œç¤¾ (æ˜“éŠç¶²/é›„ç…/å¯æ¨‚/æ±å—)</option>
                <option value="Travel_Airline">âœˆï¸ èˆªç©ºå…¬å¸å®˜ç¶² (è¯èˆª/é•·æ¦®/æ˜Ÿå®‡/è™èˆª)</option>
                <option value="Travel_Transport">ğŸš„ åœ‹å…§äº¤é€š (é«˜éµ/Uber/å°ç£å¤§è»ŠéšŠ/ç§Ÿè»Š)</option>
            </optgroup>

            <optgroup label="ğŸ›ï¸ è³¼ç‰©/é¤é£² (CUBE æ¨‚é¥—è³¼)">
                <option value="Shop_Dept">ğŸ¬ ç™¾è²¨å…¬å¸ (SOGO/æ–°å…‰ä¸‰è¶Š/é ç™¾/å·¨åŸ/101)</option>
                <option value="Shop_Delivery">ğŸ›µ å¤–é€å¹³å° (UberEats / Foodpanda)</option>
                <option value="Shop_Food">ğŸ½ï¸ é¤å»³/é¤é£² (é€£é–é¤å»³/æ˜Ÿå·´å…‹/æ‰‹æ–é£²/é€Ÿé£Ÿ)</option>
                <option value="Shop_Clothing">ğŸ‘— æœé£¾/è—¥å¦ (Uniqlo/Zara/H&M/å±ˆè‡£æ°/åº·æ˜¯ç¾)</option>
            </optgroup>

            <optgroup label="ğŸ“± ç¶²è³¼/æ•¸ä½ (CUBE ç©æ•¸ä½)">
                <option value="Digital_Ecom">ğŸ“¦ ç¶œåˆç¶²è³¼ (è¦çš®/Momo/PChome/Yahoo)</option>
                <option value="Digital_Coupang">ğŸš€ é…·æ¾ Coupang (å°ç£)</option>
                <option value="Digital_Stream">ğŸ¬ ä¸²æµå½±éŸ³ (Netflix/Disney+/Spotify/YouTube)</option>
                <option value="Digital_Game">ğŸ® éŠæˆ²å¹³å° (Steam/Nintendo/PlayStation)</option>
            </optgroup>

            <optgroup label="ğŸª ç”Ÿæ´»/ç¹³è²» (CUBE é›†ç²¾é¸)">
                <option value="Life_Supermarket">ğŸ›’ é‡è²©è¶…å¸‚ (å…¨è¯/å®¶æ¨‚ç¦/IKEA/æ„›è²·)</option>
                <option value="Life_CVS">ğŸª è¶…å•† (7-11/å…¨å®¶ - éœ€åˆ·å¯¦é«”å¡æˆ–ç‰¹å®šPay)</option>
                <option value="Life_Gas">â›½ åŠ æ²¹ (ä¸­æ²¹ç›´ç‡Ÿç«™/å°å¡‘)</option>
                <option value="Life_Telecom_5G">ğŸ“¡ å°ç£å¤§å“¥å¤§ 5G è³‡è²»</option>
                <option value="Life_Telecom_4G">ğŸ“± å°ç£å¤§å“¥å¤§ 4G / å…¶ä»–é›»ä¿¡</option>
            </optgroup>

            <optgroup label="ğŸ‚ å…¶ä»–/ç‰¹æ®Š">
                <option value="Birthday_Special">ğŸ‚ æ…¶ç”ŸæœˆæŒ‡å®š (æ•™çˆ¶ç‰›æ’/æ—­é›†/å±‹é¦¬/éŒ¢æ«ƒ)</option>
                <option value="Pay_LinePay">ğŸ“² LINE Pay ä¸€èˆ¬æ¶ˆè²»</option>
            </optgroup>
        </select>
    </div>

    <label class="checkbox-wrapper">
        <input type="checkbox" id="isBirthday">
        <span>ğŸ‚ æˆ‘æ˜¯ç•¶æœˆå£½æ˜Ÿ (CUBE æ…¶ç”Ÿæœˆ 10%)</span>
    </label>
    
    <label class="checkbox-wrapper" style="background:#fff3e0; border-color:#ffe0b2;">
        <input type="checkbox" id="fubonThreshold">
        <span>âš¡ å¯Œé‚¦ OP å¡æœ¬æœˆå·²åˆ·æ»¿ $5,000</span>
    </label>

    <div class="cube-section">
        <div class="cube-label">ğŸŒ² CUBE è¨­å®šç‹€æ…‹</div>
        <label>ç›®å‰ App åˆ‡æ›åœ¨å“ªå€‹æ–¹æ¡ˆï¼Ÿ</label>
        <select id="cubePlan">
            <option value="Travel">è¶£æ—…è¡Œ (Travel)</option>
            <option value="Shopping">æ¨‚é¥—è³¼ (Shopping)</option>
            <option value="Digital">ç©æ•¸ä½ (Digital)</option>
            <option value="Select">é›†ç²¾é¸ (Select)</option>
            <option value="Birthday">æ…¶ç”Ÿæœˆ (Birthday) [éœ€ç™»éŒ„]</option>
            <option value="Payment">ä¾†æ”¯ä»˜ (Payment) [LPå°ˆç”¨]</option>
        </select>
        <div style="margin-top: 10px;">
            <label>ä½ çš„ç­‰ç´š</label>
            <select id="cubeLevel">
                <option value="2">Level 2 (æŒæœ‰æˆ¶é ­) - 3%</option>
                <option value="3">Level 3 (è²¡ç®¡è²´è³“) - 3.3%</option>
            </select>
        </div>
    </div>

    <button onclick="calculate()">ğŸ”® ç«‹å³æª¢æ¸¬å›é¥‹</button>

    <div id="resultArea" class="result-area"></div>
</div>

<script>
    window.onload = function() {
        const now = new Date();
        now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
        document.getElementById('txnTime').value = now.toISOString().slice(0,16);
    };

    function calculate() {
        const amount = parseFloat(document.getElementById('amount').value);
        const scenario = document.getElementById('scenario').value;
        const cubePlan = document.getElementById('cubePlan').value;
        const cubeLevel = parseInt(document.getElementById('cubeLevel').value);
        const isBirthday = document.getElementById('isBirthday').checked;
        const fubonThreshold = document.getElementById('fubonThreshold').checked;

        if (!amount) { alert("è«‹è¼¸å…¥é‡‘é¡ï¼"); return; }

        let results = [];
        let isOverseas = scenario.includes("Travel_Overseas");
        let fee = isOverseas ? 0.015 : 0;

        // --- 1. åœ‹æ³° CUBE å¡ (æ ¸å¿ƒé‚è¼¯) ---
        let cubeRate = 0.003;
        let cubeHighRate = (cubeLevel === 2) ? 0.03 : 0.033;
        let note = "æ–¹æ¡ˆä¸ç¬¦ (0.3%)";
        let status = "FAIL"; 
        let match = false;

        // >> è¶£æ—…è¡Œ (Travel)
        if (cubePlan === "Travel") {
            // åŒ…å«æ‰€æœ‰æµ·å¤–å¯¦é«”ã€OTAã€æ—…éŠå¹³å°ã€æ—…è¡Œç¤¾ã€èˆªç©ºã€äº¤é€š
            if (scenario.startsWith("Travel_")) match = true;
        }
        // >> æ¨‚é¥—è³¼ (Shopping)
        else if (cubePlan === "Shopping") {
            if (scenario.startsWith("Shop_")) match = true;
        }
        // >> ç©æ•¸ä½ (Digital)
        else if (cubePlan === "Digital") {
            // åŒ…å«è¦çš®ã€Momoã€é…·æ¾ã€ä¸²æµã€éŠæˆ²
            if (scenario.startsWith("Digital_")) match = true;
        }
        // >> é›†ç²¾é¸ (Select)
        else if (cubePlan === "Select") {
            // åŒ…å«é‡è²©ã€è¶…å•†ã€åŠ æ²¹ã€é›»ä¿¡
            if (scenario.startsWith("Life_")) match = true;
        }
        // >> æ…¶ç”Ÿæœˆ (Birthday)
        else if (cubePlan === "Birthday" && isBirthday) {
            if (scenario === "Birthday_Special" || scenario === "Shop_Food" || scenario === "Digital_Game") {
                 cubeRate = 0.10; match = true; status = "10%"; note = "ğŸ‚ å£½æ˜Ÿ 10% åŠ ç¢¼ï¼";
            } else if (scenario === "Shop_Dept") {
                 cubeRate = 0.035; match = true; note = "ğŸ‚ å£½æ˜Ÿç™¾è²¨ 3.5%";
            }
        }
        // >> ä¾†æ”¯ä»˜ (Payment)
        else if (cubePlan === "Payment" && scenario === "Pay_LinePay") {
            cubeRate = 0.02; if(cubeLevel >= 3) cubeRate = 0.03; 
            match = true; note = "LINE Pay å›é¥‹";
        }

        if (match && status !== "10%") {
            cubeRate = cubeHighRate; status = "OK"; note = "âœ… æ–¹æ¡ˆæ­£ç¢º";
        }
        
        // éŸ“åœ‹å¯¦é«”æ»¿é¡åŠ ç¢¼ (æ¨¡æ“¬ 2025 Q4 æ´»å‹•)
        let bonus = 0;
        if (scenario === "Travel_Overseas_KR" && cubePlan === "Travel" && match) {
             if (amount >= 20000) { bonus = 700; note += " + ğŸ‡°ğŸ‡·æ»¿é¡ç¦®"; }
        }

        let cubeRes = calcCard("åœ‹æ³° CUBE å¡", cubeRate, fee, amount, note, status);
        cubeRes.netProfit += bonus; // åŠ å›æ»¿é¡ç¦®
        results.push(cubeRes);


        // --- 2. è¯é‚¦å‰é¶´å¡ (æ—¥æœ¬å°ˆæ­¦) ---
        let jiheRate = 0.01;
        let jiheNote = "åœ‹å…§ 1%";
        
        if (scenario === "Travel_Overseas_JP_Apple") {
            jiheRate = 0.04; jiheNote = "æ—¥æœ¬ QUICPay (4%)";
        } else if (scenario === "Travel_Overseas_JP") {
            jiheRate = 0.025; jiheNote = "æ—¥æœ¬å¯¦é«” (2.5%)";
        } else if (scenario === "Travel_Overseas_KR") {
            jiheRate = 0.01; jiheNote = "éŸ“åœ‹ä¸€èˆ¬æ¶ˆè²» (1%)";
        } else if (isOverseas) {
            jiheRate = 0.01; jiheNote = "æµ·å¤–ä¸€èˆ¬ (1%)";
        }
        // Q4 æ—…éŠæ»¿é¡ç¦®åˆ¤å®š (æ©Ÿç¥¨/é£¯åº—/æ—…è¡Œç¤¾/OTA)
        if (scenario === "Travel_Agency" || scenario === "Travel_OTA" || scenario === "Travel_Platform" || scenario === "Travel_Airline") {
             // å‡è¨­ç¬¦åˆ Q4 æ»¿é¡æ¢ä»¶
             if (amount >= 30000) { jiheNote += " + Q4æ»¿é¡ç¦®"; } 
        }

        results.push(calcCard("è¯é‚¦å‰é¶´å¡", jiheRate, fee, amount, jiheNote, "NORMAL"));


        // --- 3. å¯Œé‚¦ Open Possible ---
        let opRate = 0.01;
        let opNote = "ä¸€èˆ¬ 1%";
        let isOpHigh = fubonThreshold || amount >= 5000;

        if (isOpHigh) {
            if (scenario === "Life_Telecom_5G") {
                opRate = 0.035; opNote = "å°å“¥å¤§ 5G (3.5%)";
            } else if (scenario === "Life_Telecom_4G" || scenario === "Life_Gas" || scenario === "Life_CVS" || isOverseas) {
                opRate = 0.02; opNote = "æŒ‡å®š/æµ·å¤– 2%";
            }
        } else {
             opNote = "æœªæ»¿é–€æª» (1%)";
        }
        results.push(calcCard("å¯Œé‚¦ Open Possible", opRate, fee, amount, opNote, "NORMAL"));

        // æ’åº
        results.sort((a, b) => b.netProfit - a.netProfit);
        renderResults(results);
    }

    function calcCard(name, rate, fee, amount, note, status) {
        let netProfit = Math.round(amount * (rate - fee));
        let netRate = ((rate - fee) * 100).toFixed(1);
        return { name, netProfit, netRate, note, status };
    }

    function renderResults(data) {
        const area = document.getElementById('resultArea');
        area.innerHTML = "";
        data.forEach((item, index) => {
            let className = "card-card";
            if (index === 0 && item.netProfit > 0) className += " winner";
            
            let badge = "";
            if (item.status === "OK") badge = `<span class="badge badge-ok">æ–¹æ¡ˆæ­£ç¢º</span>`;
            if (item.status === "FAIL") badge = `<span class="badge badge-fail">åˆ‡æ›éŒ¯èª¤</span>`;
            if (item.status === "10%") badge = `<span class="badge badge-10">å£½æ˜Ÿ 10%</span>`;

            let html = `
                <div class="${className}">
                    <div class="crown">ğŸ‘‘</div>
                    <div class="card-info">
                        <h3>${item.name}</h3>
                        ${badge}
                        <p style="margin-top:4px; font-size:0.85rem; color:#666;">${item.note}</p>
                    </div>
                    <div class="amount-box">
                        <div class="final-profit">$${item.netProfit}</div>
                        <small style="color:#999">æ·¨å›é¥‹ ${item.netRate}%</small>
                    </div>
                </div>
            `;
            area.innerHTML += html;
        });
    }
</script>

</body>
</html>